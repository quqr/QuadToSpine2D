<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:suki="https://github.com/kikipoulet/SukiUI"
             xmlns:paz="using:Avalonia.Controls.PanAndZoom"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="800"
             x:Class="QTSAvalonia.Views.Pages.Player"
             xmlns:pages="clr-namespace:QTSAvalonia.ViewModels.Pages"
             xmlns:userControls="clr-namespace:QTSAvalonia.ViewModels.UserControls"
             xmlns:fluent="clr-namespace:FluentIcons.Avalonia.Fluent;assembly=FluentIcons.Avalonia.Fluent"
             x:DataType="pages:PlayerViewModel">
    <Design.DataContext>
        <pages:PlayerViewModel />
    </Design.DataContext>
    <UserControl.Styles>
        <Style Selector="Path.dashed-axis">
            <Setter Property="StrokeDashArray" Value="1.5,1" />
            <Setter Property="StrokeThickness" Value="2" />
            <Setter Property="Stroke" Value="Black" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="HorizontalAlignment" Value="Center" />
        </Style>
        <Style Selector="GridSplitter">
            <Setter Property="Background" Value="WhiteSmoke" />
            <Setter Property="CornerRadius" Value="2" />
            <Setter Property="Opacity" Value="0.6" />
        </Style>
        <Style Selector="GridSplitter:pointerover">
            <Setter Property="Background" Value="#60FFFFFF" />
            <Setter Property="Opacity" Value="1" />
        </Style>
        <Style Selector="GridSplitter:pressed">
            <Setter Property="Background" Value="#80FFFFFF" />
        </Style>
    </UserControl.Styles>
    <Panel>
        <Grid RowDefinitions="8.5*,0.1*,1.5*">
            <Grid Grid.Row="0" ColumnDefinitions="5*,0.1*,5*">
                <suki:GlassCard Grid.Column="2" Margin="5">
                    <Grid RowDefinitions="9*,1*">
                        <paz:ZoomBorder
                            Stretch="None" ZoomSpeed="1.1"
                            ClipToBounds="True" Focusable="True"
                            VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                            MinZoomX="0.1"
                            MinZoomY="0.1"
                            MaxZoomX="5"
                            MaxZoomY="5">
                            <Grid>
                                <Grid.RenderTransform>
                                    <TranslateTransform
                                        X="{Binding Bounds.Width, RelativeSource={RelativeSource AncestorType=paz:ZoomBorder}}"
                                        Y="{Binding Bounds.Height, RelativeSource={RelativeSource AncestorType=paz:ZoomBorder}}" />
                                </Grid.RenderTransform>
                                <Border Background="{userControls:ChessboardBackground}"
                                        Width="20000"
                                        Height="20000" />
                                <!-- 坐标轴居中显示 -->
                                <Path ZIndex="10" Classes="dashed-axis" Stroke="Black">
                                    <Path.Data>
                                        <LineGeometry StartPoint="-20000,0" EndPoint="20000,0" />
                                    </Path.Data>
                                </Path>
                                <Path ZIndex="10" Classes="dashed-axis" Stroke="Black">
                                    <Path.Data>
                                        <LineGeometry StartPoint="0,-20000" EndPoint="0,20000" />
                                    </Path.Data>
                                </Path>
                                <Border ZIndex="1000" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Image
                                        Source="{Binding Image}" />
                                </Border>
                            </Grid>
                        </paz:ZoomBorder>
                        <StackPanel Grid.Row="1"
                                    HorizontalAlignment="Center">
                            <Grid ColumnDefinitions="8*,2*">
                                <Slider Value="{Binding CurrentFrame}"
                                        Minimum="0"
                                        Maximum="{Binding TotalFrames}" />
                                <TextBlock Grid.Column="1"
                                           VerticalAlignment="Center">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0}/{1}">
                                            <Binding Path="CurrentFrame" />
                                            <Binding Path="TotalFrames" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Grid>
                            <StackPanel Orientation="Horizontal" Spacing="5">
                                <Button
                                    Command="{Binding SetPreviousFrameCommand}">
                                    <fluent:FluentIcon Icon="Previous" />
                                </Button>
                                <Button
                                    Command="{Binding PlayAnimationCommand}"
                                    IsEnabled="{Binding !IsPlaying}">
                                    <fluent:FluentIcon Icon="Play" />

                                </Button>
                                <Button
                                    Command="{Binding StopPlaybackCommand}"
                                    IsEnabled="{Binding IsPlaying}">
                                    <fluent:FluentIcon Icon="Stop" />

                                </Button>
                                <Button
                                    Command="{Binding SetNextFrameCommand}">
                                    <fluent:FluentIcon Icon="Next" />

                                </Button>
                                <Button
                                    Command="{Binding QuicklyLoadCommand}">
                                    <fluent:FluentIcon Icon="ArrowSync" />
                                </Button>

                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </suki:GlassCard>
                <GridSplitter Grid.Column="1" Width="4" Margin="2,0" />
                <!-- buttons  -->
                <suki:GlassCard Grid.Column="0" Margin="5">
                    <Grid ColumnDefinitions="*,*,*,*">
                        <ScrollViewer
                            Margin="15"
                            Height="{Binding $parent[Grid].Bounds.Height,RelativeSource={RelativeSource AncestorType=Grid}}">
                            <ItemsControl
                                ItemsSource="{Binding Skeletons}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Spacing="4" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </ScrollViewer>
                        <ScrollViewer Grid.Column="1"
                                      Margin="15"
                                      Height="{Binding $parent[Grid].Bounds.Height,RelativeSource={RelativeSource AncestorType=Grid}}">
                            <ItemsControl
                                ItemsSource="{Binding Animations}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Spacing="4" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </ScrollViewer>
                        <ScrollViewer Grid.Column="2"
                                      Margin="15"
                                      Height="{Binding $parent[Grid].Bounds.Height,RelativeSource={RelativeSource AncestorType=Grid}}">
                            <ItemsControl
                                ItemsSource="{Binding Keyframes}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Spacing="4" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </ScrollViewer>
                        <ScrollViewer Grid.Column="3"
                                      Margin="15"
                                      Height="{Binding $parent[Grid].Bounds.Height,RelativeSource={RelativeSource AncestorType=Grid}}">
                            <ItemsControl
                                ItemsSource="{Binding Layers}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Spacing="4" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </suki:GlassCard>
            </Grid>
            <GridSplitter Grid.Row="1" Height="4" Margin="0,2" />
            <suki:GlassCard Grid.Row="2">
                <Grid ColumnDefinitions="1*,1*,1*,1*,2*">
                    <Button Width="150" Grid.Column="0" Content="Select quad"
                            Command="{Binding  OpenQuadFilePickerCommand}" />
                    <Button Width="150" Grid.Column="1" Content="Select images"
                            Command="{Binding OpenImageFilePickerCommand}" />
                    <Button Width="150" Grid.Column="2" Content="Load" Command="{Binding LoadCommand}" />
                    <Button Width="150" Grid.Column="3" Content="Clear" Command="{Binding ClearCommand}" />
                    <ScrollViewer Grid.Column="4">
                        <StackPanel Spacing="5" HorizontalAlignment="Center">
                            <TextBlock Text="{Binding  QuadFileName}" />
                            <ScrollViewer>
                                <ItemsControl ItemsSource="{Binding  ImagePaths}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </suki:GlassCard>
        </Grid>
    </Panel>

</UserControl>